<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Ticket Management System{% endblock %}</title>

    <!-- Google Font: Source Sans Pro -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />
    <!-- AdminLTE CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Bootstrap Icons (used by AdminLTE v4) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- Dark Mode Support -->
    <style>
      /* Light Theme Variables */
      :root {
        --main-bg: #f4f6f9;
        --sidebar-bg: #343a40;
        --navbar-bg: #ffffff;
        --content-bg: #ffffff;
        --text-color: #495057;
        --text-muted: #6c757d;
        --border-color: #dee2e6;
        --primary-color: #007bff;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --card-shadow: rgba(0, 0, 0, 0.1);
      }

      /* Dark Theme Variables */
      [data-theme="dark"] {
        --main-bg: #1a1a1a;
        --sidebar-bg: #2d3748;
        --navbar-bg: #2d3748;
        --content-bg: #374151;
        --text-color: #e2e8f0;
        --text-muted: #a0aec0;
        --border-color: #4a5568;
        --primary-color: #4299e1;
        --success-color: #48bb78;
        --danger-color: #f56565;
        --warning-color: #ed8936;
        --info-color: #4fd1c7;
        --card-shadow: rgba(0, 0, 0, 0.3);
      }

      /* Apply dark theme styles */
      [data-theme="dark"] .wrapper {
        background-color: var(--main-bg);
      }

      [data-theme="dark"] .main-sidebar {
        background-color: var(--sidebar-bg) !important;
      }

      [data-theme="dark"] .main-header {
        background-color: var(--navbar-bg) !important;
        border-bottom: 1px solid var(--border-color);
      }

      [data-theme="dark"] .content-wrapper {
        background-color: var(--main-bg);
      }

      [data-theme="dark"] .card-header {
        background-color: var(--content-bg);
        border-bottom: 1px solid var(--border-color);
        color: var(--text-color);
      }

      [data-theme="dark"] .form-control,
      [data-theme="dark"] .form-select {
        background-color: var(--content-bg);
        border-color: var(--border-color);
        color: var(--text-color);
      }

      [data-theme="dark"] .form-control:focus,
      [data-theme="dark"] .form-select:focus {
        background-color: var(--content-bg);
        border-color: var(--primary-color);
        color: var(--text-color);
      }

      [data-theme="dark"] .btn-outline-secondary {
        color: var(--text-color);
        border-color: var(--border-color);
      }

      [data-theme="dark"] .btn-outline-secondary:hover {
        background-color: var(--border-color);
        color: var(--text-color);
      }

      [data-theme="dark"] .table {
        color: var(--text-color);
      }

      [data-theme="dark"] .table th,
      [data-theme="dark"] .table td {
        border-color: var(--border-color);
      }

      [data-theme="dark"] .nav-sidebar .nav-link {
        color: var(--text-color) !important;
      }

      [data-theme="dark"] .nav-sidebar .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1) !important;
      }

      [data-theme="dark"] .brand-link {
        color: var(--text-color) !important;
        border-bottom: 1px solid var(--border-color) !important;
      }

      [data-theme="dark"] .sidebar-user-panel .info a {
        color: var(--text-color) !important;
      }

      [data-theme="dark"] .navbar-nav .nav-link {
        color: var(--text-color) !important;
      }

      [data-theme="dark"] .navbar-nav .nav-link:hover {
        color: var(--primary-color) !important;
      }

      [data-theme="dark"] .dropdown-menu {
        background-color: var(--content-bg);
        border-color: var(--border-color);
      }

      [data-theme="dark"] .dropdown-item {
        color: var(--text-color);
      }

      [data-theme="dark"] .dropdown-item:hover {
        background-color: var(--border-color);
        color: var(--text-color);
      }

      /* Theme Toggle Button */
      .theme-toggle {
        background: transparent;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--primary-color);
      }
    </style>

    <!-- Custom CSS for ticket system -->
    <style>
      .ticket-priority-urgent {
        border-left: 4px solid #dc3545;
        animation: pulse 2s infinite;
      }

      .ticket-priority-high {
        border-left: 4px solid #ffc107;
      }

      .ticket-priority-medium {
        border-left: 4px solid #17a2b8;
      }

      .ticket-priority-low {
        border-left: 4px solid #28a745;
      }

      @keyframes pulse {
        0% {
          border-left-color: #dc3545;
        }
        50% {
          border-left-color: #ff0000;
        }
        100% {
          border-left-color: #dc3545;
        }
      }

      .small-box {
        border-radius: 10px;
        box-shadow: 0 0 1px rgba(0, 0, 0, 0.125), 0 1px 3px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      .sidebar-user-panel {
        border-bottom: 1px solid #4f5962;
        margin-bottom: 10px;
        padding-bottom: 10px;
      }

      /* Timeline Styles for Comments */
      .timeline {
        position: relative;
        margin: 0 0 20px 0;
        padding: 0;
        list-style: none;
      }

      .timeline:before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        left: 15px;
        width: 4px;
        background: #d2d6de;
      }

      .timeline > div {
        position: relative;
        margin: 0 0 10px 0;
        clear: both;
      }

      .timeline > div > .timeline-item {
        -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        border-radius: 3px;
        position: relative;
        margin: 0 0 0 35px;
        background: #fff;
        color: #444;
      }

      .timeline > div > .fas {
        width: 30px;
        height: 30px;
        font-size: 15px;
        line-height: 30px;
        position: absolute;
        color: #666;
        background: #d2d6de;
        border-radius: 50%;
        text-align: center;
        left: 0;
        top: 0;
      }

      .timeline > .time-label > span {
        font-weight: 600;
        color: #fff;
        border-radius: 4px;
        display: inline-block;
        padding: 5px;
      }

      .timeline-header {
        margin: 0;
        color: #555;
        border-bottom: 1px solid #f4f4f4;
        padding: 10px;
        font-weight: 600;
        font-size: 16px;
      }

      .timeline-body {
        padding: 10px;
      }

      .timeline-footer {
        padding: 10px;
        background-color: #f4f4f4;
      }
    </style>
  </head>

  <body class="hold-transition sidebar-mini layout-fixed dark-mode">
    <div class="wrapper">
      <!-- Navbar -->
      <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button">
              <i class="fas fa-bars"></i>
            </a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="{% url 'tickets:home' %}" class="nav-link">Home</a>
          </li>
        </ul>

        <!-- Right navbar links -->
        <ul class="navbar-nav ml-auto">
          <!-- Theme Toggle Button -->
          <li class="nav-item">
            <button
              class="nav-link theme-toggle"
              id="themeToggle"
              title="Toggle Dark Mode"
            >
              <i class="fas fa-moon" id="themeIcon"></i>
            </button>
          </li>
          {% if user.is_authenticated %}
          <!-- User dropdown -->
          <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
              <span class="dropdown-item dropdown-header">
                Welcome, {{ user.first_name|default:user.username }}!
                <i class="far fa-user ml-1"></i>
              </span>

              <span class="badge badge-info navbar-badge" style="display: none"
                >0</span
              >
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
              <div class="dropdown-divider"></div>
              <a href="{% url 'tickets:ticket_list' %}" class="dropdown-item">
                <i class="fas fa-ticket-alt mr-2"></i> My Tickets
              </a>
              <div class="dropdown-divider"></div>
              <a href="{% url 'tickets:create_ticket' %}" class="dropdown-item">
                <i class="fas fa-plus mr-2"></i> Create Ticket
              </a>
              {% if user.is_staff %}
              <div class="dropdown-divider"></div>
              <a href="/admin/" target="_blank" class="dropdown-item">
                <i class="fas fa-cogs mr-2"></i> Admin Panel
              </a>
              {% endif %}
              <div class="dropdown-divider"></div>
              <a href="{% url 'tickets:logout' %}" class="dropdown-item">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
              </a>
            </div>
          </li>
          {% else %}
          <li class="nav-item">
            <a href="{% url 'tickets:login' %}" class="nav-link">
              <i class="fas fa-sign-in-alt"></i> Login
            </a>
          </li>
          {% endif %}
        </ul>
      </nav>

      <!-- Main Sidebar Container -->
      <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->
        <a
          href="{% url 'tickets:home' %}"
          class="brand-link d-flex align-items-center"
        >
          <i
            class="fas fa-ticket-alt brand-image img-circle elevation-3 ml-3"
            style="opacity: 0.8; font-size: 2rem; color: white"
          ></i>
          <span class="brand-text font-weight-light ml-2">Ticket System</span>
        </a>

        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Sidebar Menu -->
          <nav class="mt-2">
            <ul
              class="nav nav-pills nav-sidebar flex-column"
              data-widget="treeview"
              role="menu"
              data-accordion="false"
            >
              {% if user.is_authenticated %}
              <li class="nav-item">
                <a
                  href="{% url 'tickets:home' %}"
                  class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}"
                >
                  <i class="nav-icon fas fa-home"></i>
                  <p>Dashboard</p>
                </a>
              </li>

              <li class="nav-header">TICKET MANAGEMENT</li>

              <li class="nav-item">
                <a
                  href="{% url 'tickets:ticket_list' %}"
                  class="nav-link {% if request.resolver_match.url_name == 'ticket_list' %}active{% endif %}"
                >
                  <i class="nav-icon fas fa-list"></i>
                  <p>My Tickets</p>
                </a>
              </li>

              <li class="nav-item">
                <a
                  href="{% url 'tickets:create_ticket' %}"
                  class="nav-link {% if request.resolver_match.url_name == 'create_ticket' %}active{% endif %}"
                >
                  <i class="nav-icon fas fa-plus-circle"></i>
                  <p>Create Ticket</p>
                </a>
              </li>

              {% if user.is_staff %}
              <li class="nav-header">ADMINISTRATION</li>

              <li class="nav-item">
                <a
                  href="{% url 'tickets:security_dashboard' %}"
                  class="nav-link {% if request.resolver_match.url_name == 'security_dashboard' %}active{% endif %}"
                >
                  <i class="nav-icon fas fa-shield-alt"></i>
                  <p>Security Dashboard</p>
                </a>
              </li>

              <li class="nav-item">
                <a href="/admin/" target="_blank" class="nav-link">
                  <i class="nav-icon fas fa-cogs"></i>
                  <p>
                    Admin Panel
                    <i class="fas fa-external-link-alt right"></i>
                  </p>
                </a>
              </li>
              {% endif %} {% else %}
              <li class="nav-item">
                <a href="{% url 'tickets:login' %}" class="nav-link">
                  <i class="nav-icon fas fa-sign-in-alt"></i>
                  <p>Login</p>
                </a>
              </li>
              {% endif %}
            </ul>
          </nav>
        </div>
      </aside>

      <!-- Content Wrapper -->
      <div class="content-wrapper">
        {% block content %}
        <!-- Content will be injected here -->
        {% endblock %}
      </div>

      <!-- Main Footer -->
      <footer class="main-footer">
        <strong
          >Copyright &copy; 2025
          <a href="#">Ticket Management System</a>.</strong
        >
        All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
          <b>Version</b> 1.0.0
        </div>
      </footer>
    </div>

    <!-- AdminLTE JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

    <!-- Custom JS -->
    <script>
      $(document).ready(function () {
        // Load saved theme
        const savedTheme = localStorage.getItem("theme") || "light";
        setTheme(savedTheme);

        // Theme toggle functionality
        $("#themeToggle").click(function () {
          const currentTheme =
            document.documentElement.getAttribute("data-theme");
          const newTheme = currentTheme === "dark" ? "light" : "dark";
          setTheme(newTheme);
          localStorage.setItem("theme", newTheme);
        });

        function setTheme(theme) {
          document.documentElement.setAttribute("data-theme", theme);
          const icon = document.getElementById("themeIcon");
          const toggle = document.getElementById("themeToggle");

          if (theme === "dark") {
            icon.className = "fas fa-sun";
            toggle.title = "Switch to Light Mode";
            // Update AdminLTE classes for dark theme
            $("body").removeClass("layout-navbar-fixed").addClass("dark-mode");
            $(".main-header")
              .removeClass("navbar-white navbar-light")
              .addClass("navbar-dark");
          } else {
            icon.className = "fas fa-moon";
            toggle.title = "Switch to Dark Mode";
            // Update AdminLTE classes for light theme
            $("body").removeClass("dark-mode").addClass("layout-navbar-fixed");
            $(".main-header")
              .removeClass("navbar-dark")
              .addClass("navbar-white navbar-light");
          }
        }

        // Initialize tooltips
        $('[data-toggle="tooltip"]').tooltip();

        // Auto-hide alerts after 5 seconds
        setTimeout(function () {
          $(".alert").fadeOut("slow");
        }, 5000);
      });
    </script>

    {% block extra_js %}
    <!-- Additional JS can be added here -->
    {% endblock %}
  </body>
</html>
