{% extends 'tickets/base.html' %} {% block title %}Dashboard - Ticket Management
System{% endblock %} {% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">Dashboard</h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <!-- Info boxes (Stat boxes) -->
    <div class="row">
      <div class="col-lg-3 col-6">
        <!-- Total Tickets -->
        <div class="small-box bg-info">
          <div class="inner">
            <h3>{{ total_tickets }}</h3>
            <p>Total Tickets</p>
          </div>
          <div class="icon">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <a href="{% url 'tickets:ticket_list' %}" class="small-box-footer">
            More info <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <!-- Open Tickets -->
        <div class="small-box bg-success">
          <div class="inner">
            <h3>{{ open_tickets }}</h3>
            <p>Open Tickets</p>
          </div>
          <div class="icon">
            <i class="fas fa-folder-open"></i>
          </div>
          <a
            href="{% url 'tickets:ticket_list' %}?status=Open"
            class="small-box-footer"
          >
            More info <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <!-- In Progress Tickets -->
        <div class="small-box bg-warning">
          <div class="inner">
            <h3>{{ in_progress_tickets }}</h3>
            <p>In Progress</p>
          </div>
          <div class="icon">
            <i class="fas fa-clock"></i>
          </div>
          <a
            href="{% url 'tickets:ticket_list' %}?status=In%20Progress"
            class="small-box-footer"
          >
            More info <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <!-- Closed Tickets -->
        <div class="small-box bg-danger">
          <div class="inner">
            <h3>{{ closed_tickets }}</h3>
            <p>Closed Tickets</p>
          </div>
          <div class="icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <a
            href="{% url 'tickets:ticket_list' %}?status=Closed"
            class="small-box-footer"
          >
            More info <i class="fas fa-arrow-circle-right"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Quick Actions Row -->
    <div class="row">
      <div class="col-12">
        <div class="card card-outline card-danger">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-bolt"></i> Quick Actions
            </h3>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                <a
                  href="{% url 'tickets:create_ticket' %}"
                  class="btn btn-success btn-lg btn-block mt-1"
                >
                  <i class="fas fa-plus-circle"></i> Create New Ticket
                </a>
              </div>
              <div class="col-md-4">
                <a
                  href="{% url 'tickets:ticket_list' %}"
                  class="btn btn-primary btn-lg btn-block mt-1"
                >
                  <i class="fas fa-list"></i> View All Tickets
                </a>
              </div>
              <div class="col-md-4">
                {% if user.is_staff %}
                <a
                  href="/admin/"
                  target="_blank"
                  class="btn btn-warning btn-lg btn-block mt-1"
                >
                  <i class="fas fa-cogs"></i> Admin Panel
                </a>
                {% else %}
                <a
                  href="{% url 'tickets:ticket_list' %}?status=Open"
                  class="btn btn-info btn-lg btn-block mt-1"
                >
                  <i class="fas fa-folder-open"></i> My Open Tickets
                </a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Tickets -->
    <div class="row">
      <div class="col-12">
        <div class="card card-outline card-secondary">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-history"></i> Recent Tickets
            </h3>
            <div class="card-tools">
              <a href="{% url 'tickets:ticket_list' %}" class="btn btn-tool">
                <i class="fas fa-external-link-alt"></i> View All
              </a>
            </div>
          </div>
          <div class="card-body table-responsive p-0">
            {% if recent_tickets %}
            <table class="table table-hover text-nowrap">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Priority</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for ticket in recent_tickets %}
                <tr
                  class="{% if ticket.priority == 'Urgent' %}ticket-priority-urgent{% elif ticket.priority == 'High' %}ticket-priority-high{% elif ticket.priority == 'Medium' %}ticket-priority-medium{% else %}ticket-priority-low{% endif %}"
                >
                  <td>{{ ticket.id }}</td>
                  <td>
                    <a href="{% url 'tickets:ticket_detail' ticket.pk %}">
                      {{ ticket.title|truncatechars:50 }}
                    </a>
                  </td>
                  <td>
                    {% if ticket.priority == 'Urgent' %}
                    <span class="badge badge-danger">
                       {{ ticket.priority }}
                    </span>
                    {% elif ticket.priority == 'High' %}
                    <span class="badge badge-warning">
                      {{ ticket.priority }}
                    </span>
                    {% elif ticket.priority == 'Medium' %}
                    <span class="badge badge-info">
                      {{ ticket.priority }}
                    </span>
                    {% else %}
                    <span class="badge badge-secondary">
                      {{ ticket.priority }}
                    </span>
                    {% endif %}
                  </td>
                  <td>
                    {% if ticket.status == 'Open' %}
                    <span class="badge badge-success">{{ ticket.status }}</span>
                    {% elif ticket.status == 'In Progress' %}
                    <span class="badge badge-warning">{{ ticket.status }}</span>
                    {% else %}
                    <span class="badge badge-secondary"
                      >{{ ticket.status }}</span
                    >
                    {% endif %}
                  </td>
                  <td>
                    <small>{{ ticket.created_at|date:"M d, Y H:i" }}</small>
                  </td>
                  <td>
                    <a
                      href="{% url 'tickets:ticket_detail' ticket.pk %}"
                      class="btn btn-sm btn-outline-primary"
                      data-toggle="tooltip"
                      title="View Details"
                    >
                      <i class="fas fa-eye"></i>
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <div class="p-4 text-center">
              <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
              <p class="text-muted">
                No tickets found.
                <a href="{% url 'tickets:create_ticket' %}"
                  >Create your first ticket</a
                >!
              </p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Priority Distribution Chart (if you want to add charts later) -->
    {% comment %}
    <div class="row">
      <div class="col-md-6">
        <div class="card card-outline card-secondary">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-chart-pie"></i> Priority Distribution
            </h3>
          </div>
          <div class="card-body">
            <!-- Chart will go here -->
            <canvas
              id="priorityChart"
              style="
                min-height: 250px;
                height: 250px;
                max-height: 250px;
                max-width: 100%;
              "
            ></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card card-outline card-warning">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-chart-bar"></i> Status Overview
            </h3>
          </div>
          <div class="card-body">
            <!-- Chart will go here -->
            <canvas
              id="statusChart"
              style="
                min-height: 250px;
                height: 250px;
                max-height: 250px;
                max-width: 100%;
              "
            ></canvas>
          </div>
        </div>
      </div>
    </div>
    {% endcomment %}
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  $(document).ready(function () {
    // Add any dashboard-specific JavaScript here
    console.log("Dashboard loaded successfully!");

    // Example: Auto-refresh ticket counts every 5 minutes
    // setInterval(function() {
    //     location.reload();
    // }, 300000);
  });
</script>
{% endblock %}
